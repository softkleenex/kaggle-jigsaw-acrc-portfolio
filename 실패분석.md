# ì‹¤íŒ¨ ë¶„ì„: Qwen LoRA ì¶”ë¡ ì´ ì‹¤íŒ¨í•œ ì´ìœ 

> **ê°€ì„¤ â†’ ì¦ê±° â†’ ê²°ë¡ ì˜ ì²´ê³„ì  ë””ë²„ê¹… ê³¼ì •**

[â† ë©”ì¸ READMEë¡œ ëŒì•„ê°€ê¸°](README_KR.md)

---

## ğŸ¬ ìš”ì•½ (ë°”ìœ ë¶„ë“¤ì„ ìœ„í•œ 3ì¤„)

1. **ë¬¸ì œ:** Qwen 2.5 1.5B ëª¨ë¸ì— ê³µê°œ LoRA ì–´ëŒ‘í„° ì ìš© â†’ ëª¨ë“  ì˜ˆì¸¡ê°’ 0.0
2. **ê·¼ë³¸ ì›ì¸:** 4Bìš© ì–´ëŒ‘í„°ë¥¼ 1.5B ëª¨ë¸ì— ë¡œë“œ (ë² ì´ìŠ¤ ëª¨ë¸ ë¶ˆì¼ì¹˜)
3. **êµí›ˆ:** Configë§Œ ë¯¿ì§€ ë§ê³  ë°ì´í„°ì…‹ ì´ë¦„, í•™ìŠµ ì•„í‹°íŒ©íŠ¸, ì†Œê·œëª¨ í…ŒìŠ¤íŠ¸ êµì°¨ ê²€ì¦ í•„ìˆ˜

---

## ğŸ“… ì‹¤íŒ¨ íƒ€ì„ë¼ì¸

### 2024ë…„ 10ì›” 22ì¼ ì˜¤ì „ 10:00 - Tier 1 v1 ì‹œë„

**ì‹œë„ ë‚´ìš©:**
```python
ë² ì´ìŠ¤ ëª¨ë¸: Qwen/Qwen2.5-1.5B-Instruct
ì–´ëŒ‘í„°: mahmoudmohamed/reddit-4b-think (ê³µê°œ)
í”„ë¡¬í”„íŠ¸: ê¸°ë³¸ instruction format

def create_prompt(row):
    prompt = f"""You are a content moderator.
Determine if the following post violates the given rule.

Rule: {row['rule']}
Post to evaluate: {row['body']}

Does this post violate the rule?
Answer with a probability between 0 and 1.

Probability:"""
    return prompt
```

**ê²°ê³¼:**
```
ì „ì²´ 10ê°œ ì˜ˆì¸¡
â†’ ëª¨ë‘ 0.0 ğŸ˜±

íŒŒì‹± ì„±ê³µë¥ : ~50%
ì‹¤íŒ¨ ì‚¬ë¡€: "I don't think this violates" (ìˆ«ì ì—†ìŒ)
```

**ì†Œìš” ì‹œê°„:** 2ì‹œê°„

**ì²« ë°˜ì‘:**
> "ì•„, í”„ë¡¬í”„íŠ¸ê°€ ë„ˆë¬´ ì• ë§¤í•´ì„œ ëª¨ë¸ì´ ìˆ«ìë¥¼ ì œëŒ€ë¡œ ì•ˆ ë½‘ì•„ë‚´ëŠ”êµ¬ë‚˜. í”„ë¡¬í”„íŠ¸ë¥¼ ë” ëª…í™•í•˜ê²Œ ë§Œë“¤ì–´ì•¼ê² ë‹¤."

---

### 2024ë…„ 10ì›” 22ì¼ ì˜¤í›„ 14:00 - Tier 1 v2 ì‹œë„

**ê°œì„  ì‚¬í•­:**

| í•­ëª© | v1 | v2 (ê°œì„ ) |
|------|----|-----------|
| **Format** | Plain text | Chat template (system/user ë¶„ë¦¬) |
| **Instructions** | ì• ë§¤í•¨ | "ONLY NUMBER" ëª…ì‹œ |
| **Examples** | ì—†ìŒ | Few-shot (0.95, 0.23, 0.78...) |
| **Temperature** | 0.1 | 0.01 (deterministic) |
| **Max tokens** | 50 | 10 (ê°„ê²°í•œ ì¶œë ¥ ê°•ì œ) |
| **Parsing** | ë‹¨ìˆœ float() | 3ë‹¨ê³„ robust strategy |

**í•µì‹¬ ì½”ë“œ (v2):**
```python
def create_prompt_v2(tokenizer, row):
    system = "You are a precise AI. Respond ONLY with a decimal number between 0.0 and 1.0. NO other text."

    user = f"""Analyze if this post violates the rule.

RULE: {row['rule']}
POST: {row['body']}

Respond with ONLY a number between 0.0 and 1.0:
- 0.0 = NOT a violation
- 1.0 = IS a violation

Examples: 0.95, 0.23, 0.78, 0.02

Your answer (number only):"""

    messages = [
        {"role": "system", "content": system},
        {"role": "user", "content": user}
    ]

    return tokenizer.apply_chat_template(
        messages,
        tokenize=False,
        add_generation_prompt=True
    )

def predict_single_v2(model, tokenizer, prompt, row_id):
    # ... ìƒì„± ì½”ë“œ ...

    # Stage 1: ì§ì ‘ float íŒŒì‹±
    try:
        prob = float(text)
        return max(0.0, min(1.0, prob))
    except:
        pass

    # Stage 2: Regex ì¶”ì¶œ
    matches = re.findall(r'\b(0\.\d+|1\.0+)\b', text)
    if matches:
        return max(0.0, min(1.0, float(matches[0])))

    # Stage 3: í‚¤ì›Œë“œ ê¸°ë°˜ fallback
    if any(w in text.lower() for w in ['yes', 'violate']):
        return 0.8
    return 0.5
```

**ê²°ê³¼:**
```
ì „ì²´ 10ê°œ ì˜ˆì¸¡
â†’ ì—¬ì „íˆ ëª¨ë‘ 0.0 ğŸ˜±ğŸ˜±

í•˜ì§€ë§Œ...
íŒŒì‹± ì„±ê³µë¥ : 100% âœ…

ëª¨ë“  ì¶œë ¥:
Row 2029: "0.0" -> Parsed: 0.0 (Stage 1)
Row 2030: "0.0" -> Parsed: 0.0 (Stage 1)
Row 2031: "0.0" -> Parsed: 0.0 (Stage 1)
... (ì „ë¶€ ë™ì¼)
```

**ì†Œìš” ì‹œê°„:** 2ì‹œê°„

### ğŸš¨ í•µì‹¬ ë°œê²¬

```
íŒŒì‹±ì€ ì™„ë²½í•œë° (100% ì„±ê³µ)
ê°’ì´ ì „ë¶€ ë˜‘ê°™ë‹¤ (ëª¨ë‘ 0.0)

â†’ ì´ê±´ í”„ë¡¬í”„íŠ¸ ë¬¸ì œê°€ ì•„ë‹ˆë‹¤!
```

ëª¨ë¸ì´:
- âœ… í”„ë¡¬í”„íŠ¸ ì´í•´í•¨ (chat template ì •ìƒ ì‘ë™)
- âœ… ì¶œë ¥ í˜•ì‹ ì§€í‚´ ("0.0" ì •í™•íˆ ì¶œë ¥)
- âŒ **í•˜ì§€ë§Œ ì¶”ë¡ ì€ ì•ˆ í•¨** (ì…ë ¥ê³¼ ë¬´ê´€í•˜ê²Œ 0.0ë§Œ)

**ì—¬ê¸°ì„œ pivot:** í”„ë¡¬í”„íŠ¸ê°€ ì•„ë‹ˆë¼ **ëª¨ë¸/ì–´ëŒ‘í„° í˜¸í™˜ì„± ë¬¸ì œ**ì¼ ê°€ëŠ¥ì„± ë†’ìŒ

---

## ğŸ”¬ ê°€ì„¤ ìˆ˜ë¦½ ë° ì¦ê±° ìˆ˜ì§‘

### ê°€ì„¤ A: ë² ì´ìŠ¤ ëª¨ë¸ ë¶ˆì¼ì¹˜ (ì‹ ë¢°ë„ 80%)

**ì£¼ì¥:**
ì–´ëŒ‘í„°ê°€ Qwen 4Bìš©ìœ¼ë¡œ í•™ìŠµë˜ì—ˆëŠ”ë°, Qwen 1.5Bì— ë¡œë“œí•¨

**ì™œ ì´ê²Œ ë¬¸ì œì¸ê°€?**
```python
# LoRAì˜ ë™ì‘ ì›ë¦¬
# ê¸°ì¡´ weight Wì— low-rank update Î”W = ABë¥¼ ë”í•¨
# W': (hidden_size, hidden_size)
# A:  (hidden_size, r)
# B:  (r, hidden_size)

# ë§Œì•½ hidden_sizeê°€ ë‹¤ë¥´ë©´?
Qwen 1.5B hidden_size = 1536
Qwen 4B hidden_size   = 2560 (ì¶”ì •)

# Dimension mismatch!
# PEFT ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì˜¤ë¥˜ ì—†ì´ ë¡œë“œí•˜ì§€ë§Œ (graceful handling)
# weightsê°€ ì œëŒ€ë¡œ align ì•ˆ ë¨ â†’ degenerate output
```

**ìˆ˜ì§‘í•œ ì¦ê±°:**

#### ì¦ê±° 1-1: Adapter Config

```json
// configs/mahmoudmohamed_adapter_config.json
{
  "base_model_name_or_path": "Qwen/Qwen2.5-1.5B-Instruct",
  "lora_alpha": 32,
  "r": 16,
  "target_modules": ["q_proj", "v_proj"],
  "task_type": "CAUSAL_LM"
}
```

ConfigëŠ” "1.5Bìš©"ì´ë¼ê³  ì£¼ì¥ âœ…

#### ì¦ê±° 1-2: ë°ì´í„°ì…‹ ì´ë¦„ ë¶„ì„

```
ë°ì´í„°ì…‹ slug: mahmoudmohamed/reddit-4b-think
                                    ^^^
                                    ì£¼ëª©!
```

**"4b"ê°€ ëˆˆì— ë”!**

**í•´ì„:**
- Naming convention: `{author}/{task}-{model_size}-{method}`
- ì˜ˆ: `reddit-4b-think` = Reddit ë°ì´í„°, **4B ëª¨ë¸**, thinking/reasoning ë°©ì‹
- ConfigëŠ” ê³µìœ ë¥¼ ìœ„í•´ í¸ì§‘í–ˆì„ ê°€ëŠ¥ì„±
- ì‹¤ì œ í•™ìŠµì€ Qwen 4Bë¡œ ì§„í–‰í–ˆì„ ê°€ëŠ¥ì„± **ë†’ìŒ**

#### ì¦ê±° 1-3: í•™ìŠµ ì•„í‹°íŒ©íŠ¸ ë¶€ì¬

```bash
# mahmoudmohamed ì–´ëŒ‘í„° íŒŒì¼ êµ¬ì¡°
mahmoudmohamed/
â”œâ”€â”€ adapter_model.bin        âœ… (30MB)
â”œâ”€â”€ adapter_config.json      âœ…
â”œâ”€â”€ README.md                âœ… (ê°„ë‹¨í•œ ì„¤ëª…ë§Œ)
â””â”€â”€ train.pkl                âŒ ì—†ìŒ!
â””â”€â”€ val.pkl                  âŒ ì—†ìŒ!
â””â”€â”€ training_log.txt         âŒ ì—†ìŒ!
```

**ë¬¸ì œì :**
- ì‹¤ì œë¡œ í•™ìŠµí–ˆëŠ”ì§€ ê²€ì¦ ë¶ˆê°€
- ì–´ë–¤ ë°ì´í„°ë¡œ í•™ìŠµí–ˆëŠ”ì§€ ë¶ˆëª…
- Validation split ì—†ìŒ â†’ ì‹ ë¢°ì„± ë‚®ìŒ

#### ì¦ê±° 1-4: seojinpark ì–´ëŒ‘í„°ì™€ ë¹„êµ

```json
// configs/seojinpark_fold3_adapter_config.json
{
  "base_model_name_or_path": "Qwen/Qwen2.5-1.5B-Instruct-GPTQ-Int4",
  //                                               ^^^^^^^^^^^^^^
  //                               ëª…ì‹œì ìœ¼ë¡œ quantization variantê¹Œì§€!
  "lora_alpha": 16,
  "r": 8,
  "target_modules": ["q_proj", "v_proj", "k_proj", "o_proj"]
}
```

```bash
# seojinpark ì–´ëŒ‘í„° íŒŒì¼ êµ¬ì¡°
seojinpark/fold3/
â”œâ”€â”€ adapter_model.bin        âœ… (15MB, r=8ì´ë¼ ë” ì‘ìŒ)
â”œâ”€â”€ adapter_config.json      âœ…
â”œâ”€â”€ train.pkl                âœ… 5.9MB
â”œâ”€â”€ val.pkl                  âœ… 726KB
â””â”€â”€ trained_model/           âœ… full checkpoint
```

**ë¹„êµ ê²°ê³¼:**

| í•­ëª© | mahmoudmohamed | seojinpark | Winner |
|------|----------------|------------|--------|
| **Base model ëª…ì‹œì„±** | "1.5B-Instruct" (ì• ë§¤í•¨) | "1.5B-Instruct-**GPTQ-Int4**" (ëª…í™•) | âœ… seojinpark |
| **ë°ì´í„°ì…‹ ì´ë¦„ ì¼ê´€ì„±** | ğŸš© "4b-think" (ì¶©ëŒ!) | âœ… "jigsaw-qwen-fold3" | âœ… seojinpark |
| **í•™ìŠµ ì•„í‹°íŒ©íŠ¸** | âŒ ì—†ìŒ | âœ… train.pkl, val.pkl | âœ… seojinpark |
| **K-fold ì „ëµ** | âŒ ë‹¨ì¼ | âœ… fold0~4 ì „ì²´ ê³µê°œ | âœ… seojinpark |
| **ë‚´ê°€ í…ŒìŠ¤íŠ¸í•œ ê²°ê³¼** | âŒ ì „ë¶€ 0.0 | â±ï¸ ë¯¸í…ŒìŠ¤íŠ¸ (ëŒ€íšŒ ì¢…ë£Œ) | - |

**ê²°ë¡ :**
seojinparkì´ **ì œëŒ€ë¡œ ëœ ê³µê°œ ì–´ëŒ‘í„°**ì˜ ëª¨ìŠµì…ë‹ˆë‹¤.

---

### ê°€ì„¤ B: ì´ì§„ ë¶„ë¥˜ í•™ìŠµ (ì‹ ë¢°ë„ 60%)

**ì£¼ì¥:**
ì–´ëŒ‘í„°ê°€ binary classification (0 or 1)ìœ¼ë¡œ í•™ìŠµë˜ì—ˆëŠ”ë°, ë‚˜ëŠ” continuous probability (0.0~1.0)ë¥¼ ìš”êµ¬í•¨

**ê·¼ê±°:**
- ëª¨ë“  ì¶œë ¥ì´ 0.0 (ê²½ê³„ê°’)
- 1.0ì´ë‚˜ 0.5ê°€ ì•„ë‹Œ 0.0ë§Œ ì¶œë ¥
- "ì•ˆì „í•œ" ê°’ìœ¼ë¡œ degenerate

**Counter-evidence:**
- ë§Œì•½ binaryë¼ë©´ 0.0ê³¼ 1.0 ë‘˜ ë‹¤ ë‚˜ì™€ì•¼ í•¨
- í•˜ì§€ë§Œ **ì˜¤ì§ 0.0ë§Œ** ë‚˜ì˜´
- ì´ê±´ binary ë¬¸ì œê°€ ì•„ë‹ˆë¼ ë” ê·¼ë³¸ì ì¸ ë¬¸ì œ

**ê²°ë¡ :** ê°€ëŠ¥ì„±ì€ ìˆì§€ë§Œ ê°€ì„¤ Aë³´ë‹¤ ë‚®ìŒ

---

### ê°€ì„¤ C: í”„ë¡¬í”„íŠ¸ í˜•ì‹ ë¶ˆì¼ì¹˜ (ì‹ ë¢°ë„ 40%)

**ì£¼ì¥:**
ì–´ëŒ‘í„° í•™ìŠµ ì‹œ ì‚¬ìš©í•œ í”„ë¡¬í”„íŠ¸ í˜•ì‹ê³¼ ë‚´ í”„ë¡¬í”„íŠ¸ í˜•ì‹ì´ ë‹¤ë¦„

**Counter-evidence (ë°˜ì¦):**
- v2ì—ì„œ 100% íŒŒì‹± ì„±ê³µ
- ëª¨ë¸ì´ chat template ì´í•´í•˜ê³  ì •í™•íˆ "0.0" ì¶œë ¥
- ë§Œì•½ í”„ë¡¬í”„íŠ¸ í˜•ì‹ ë¬¸ì œë©´ íŒŒì‹±ë„ ì‹¤íŒ¨í–ˆì„ ê²ƒ

**ê²°ë¡ :** ê°€ëŠ¥ì„± ë‚®ìŒ. v2 ê²°ê³¼ê°€ ì´ ê°€ì„¤ì„ ë°˜ë°•í•¨.

---

## ğŸ’¡ ê·¼ë³¸ ì›ì¸ (ìµœì¢… ê²°ë¡ )

**ê°€ì„¤ A (ë² ì´ìŠ¤ ëª¨ë¸ ë¶ˆì¼ì¹˜)ê°€ 80% ì´ìƒ í™•ì‹¤**

### ê¸°ìˆ ì  ì„¤ëª…

```
mahmoudmohamed ì–´ëŒ‘í„°
â†’ ì‹¤ì œë¡œëŠ” Qwen 4Bìš©ìœ¼ë¡œ í•™ìŠµ
â†’ Configë§Œ "1.5B"ë¡œ í¸ì§‘ (ê³µìœ  ëª©ì ?)
â†’ 1.5B ëª¨ë¸ì— ë¡œë“œ ì‹œ dimension ë¶ˆì¼ì¹˜
â†’ PEFT ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì˜¤ë¥˜ ì—†ì´ ë¡œë“œ (graceful degradation)
â†’ í•˜ì§€ë§Œ weightsê°€ ì œëŒ€ë¡œ align ì•ˆ ë¨
â†’ ëª¨ë¸ì´ degenerate state
â†’ ê¸°ë³¸ê°’ 0.0ë§Œ ì¶œë ¥
```

### ì‰¬ìš´ ë¹„ìœ 

```
í° ì˜·(4Bìš© ì–´ëŒ‘í„°)ì„ ì‘ì€ ì‚¬ëŒ(1.5B ëª¨ë¸)í•œí…Œ ì…í˜”ë”ë‹ˆ
ì˜·ì´ í—ë í—ë í•´ì„œ ì œëŒ€ë¡œ ë™ì‘ ì•ˆ í•˜ëŠ” ê²ƒ

ì •í™•í•œ ì‚¬ì´ì¦ˆ(seojinparkì˜ 1.5B-GPTQ-Int4)ë¥¼ ì…í˜€ì•¼
ì œëŒ€ë¡œ ì‘ë™í•¨
```

---

## ğŸ“š ë°°ìš´ ì 

### 1. Config íŒŒì¼ì€ ê±°ì§“ë§í•  ìˆ˜ ìˆë‹¤

#### âŒ ì˜ëª»ëœ ì ‘ê·¼
```python
# Configë§Œ ë³´ê³  ë¯¿ê¸°
config = load_config("adapter_config.json")
if config["base_model"] == "Qwen-1.5B":
    model = load_adapter()  # ìœ„í—˜!
```

#### âœ… ì˜¬ë°”ë¥¸ ì ‘ê·¼
```python
# êµì°¨ ê²€ì¦
def validate_adapter_safety(adapter_path):
    checks = {}

    # 1. Config í™•ì¸
    config = load_config(f"{adapter_path}/adapter_config.json")
    checks["config_base_model"] = config["base_model_name_or_path"]

    # 2. ë°ì´í„°ì…‹ ì´ë¦„ í™•ì¸
    dataset_name = get_dataset_name(adapter_path)  # "reddit-4b-think"
    checks["dataset_name_conflict"] = "4b" in dataset_name and "1.5b" in config["base_model"]

    # 3. í•™ìŠµ ì•„í‹°íŒ©íŠ¸ í™•ì¸
    checks["has_training_artifacts"] = (
        os.path.exists(f"{adapter_path}/train.pkl") and
        os.path.exists(f"{adapter_path}/val.pkl")
    )

    # 4. ì†Œê·œëª¨ í…ŒìŠ¤íŠ¸
    predictions = test_on_3_samples(adapter_path)
    checks["output_diversity"] = np.std(predictions) > 0.05

    # 5. ë¶„í¬ ì •ìƒì„±
    checks["distribution_normal"] = (
        0.2 < np.mean(predictions) < 0.8 and
        np.max(predictions) > 0.3
    )

    if not all(checks.values()):
        raise ValidationError(f"Failed checks: {checks}")

    return True
```

---

### 2. 100% ì„±ê³µ ì§€í‘œê°€ ì‹¤íŒ¨ë¥¼ ìˆ¨ê¸¸ ìˆ˜ ìˆë‹¤

#### ì°©ê°
```
íŒŒì‹± ì„±ê³µë¥ : 100% âœ…
â†’ "ì™„ë²½í•˜ê²Œ ì‘ë™í•œë‹¤!"
```

#### ì‹¤ì œ
```python
predictions = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

# ì´ëŸ° ì²´í¬ê°€ í•„ìš”í–ˆë‹¤
assert np.std(predictions) > 0.05, "Too uniform! All values identical."
assert np.max(predictions) > 0.3, "No high scores! Model not predicting violations."
assert 0.2 < np.mean(predictions) < 0.8, "Skewed distribution!"
```

#### í”„ë¡œë•ì…˜ ëª¨ë‹ˆí„°ë§ í™•ì¥
```python
class ModelMonitor:
    def __init__(self):
        self.metrics = {
            "parsing_success_rate": [],
            "prediction_mean": [],
            "prediction_std": [],
            "prediction_min": [],
            "prediction_max": []
        }

    def log_batch(self, predictions, parsing_success):
        self.metrics["parsing_success_rate"].append(parsing_success)
        self.metrics["prediction_mean"].append(np.mean(predictions))
        self.metrics["prediction_std"].append(np.std(predictions))
        self.metrics["prediction_min"].append(np.min(predictions))
        self.metrics["prediction_max"].append(np.max(predictions))

        # ì´ìƒ íƒì§€
        if parsing_success == 1.0 and np.std(predictions) < 0.01:
            alert("âš ï¸ 100% parsing but degenerate outputs!")
```

---

### 3. 2ì‹œê°„ Time-boxingìœ¼ë¡œ ë¶„ì„ ë§ˆë¹„ ë°©ì§€

#### ì‹¤ì œ íˆ¬ì ì‹œê°„
```
Tier 1 v1: 2ì‹œê°„ â†’ ì‹¤íŒ¨ â†’ ë¶„ì„ 30ë¶„
Tier 1 v2: 2ì‹œê°„ â†’ ì‹¤íŒ¨ â†’ ë¶„ì„ 30ë¶„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´: 5ì‹œê°„
```

#### ë§Œì•½ ë¬´í•œì • ë””ë²„ê¹…í–ˆë‹¤ë©´?
```
âŒ 20ì‹œê°„ ë‚­ë¹„ ê°€ëŠ¥ì„±
âŒ Tunnel vision (í”„ë¡¬í”„íŠ¸ë§Œ ê³„ì† ìˆ˜ì •)
âŒ ë‹¤ë¥¸ ì ‘ê·¼ë²• (DeBERTa ensemble) ì‹œë„ ëª» í•¨
```

#### Time-boxing Rule
```
[ 2ì‹œê°„ íˆ¬ì ]
    â†“
[ ì‹¤íŒ¨ ]
    â†“
[ 30ë¶„ ë¶„ì„ ]
    â†“
ëª…í™•í•œ ë‹¤ìŒ ë°©í–¥ ìˆìŒ? â”€ YES â†’ ì§„í–‰
                       â”‚
                      NO â†’ PIVOT!
                            (ì™„ì „íˆ ë‹¤ë¥¸ ì ‘ê·¼)
```

**êµí›ˆ:** ì œí•œëœ ì‹œê°„ì— ìš°ì„ ìˆœìœ„ ê²°ì • ëŠ¥ë ¥

---

## ğŸ­ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ë™ì¼í•œ íŒ¨í„´

### ì‹œë‚˜ë¦¬ì˜¤ 1: CI/CD íŒŒì´í”„ë¼ì¸ ì¥ì• 

**ìƒí™©:**
```
ìƒˆë¡œìš´ LoRA ì–´ëŒ‘í„°ë¥¼ í”„ë¡œë•ì…˜ì— ë°°í¬
â†’ ëª¨ë“  ì˜ˆì¸¡ APIê°€ 0% fraud ë°˜í™˜
â†’ ì‹¤ì œë¡œëŠ” fraudê°€ ìˆëŠ”ë° íƒì§€ ëª» í•¨
```

**ë””ë²„ê¹… ê³¼ì •:**
```python
# 1. ëª¨ë¸ ë¡œë”© ì˜¤ë¥˜?
â†’ ì—†ìŒ âœ… (ë¡œê·¸ì— "Model loaded successfully")

# 2. ì…ë ¥ ë°ì´í„° ë¬¸ì œ?
â†’ ì •ìƒ âœ… (ì…ë ¥ validation pass)

# 3. ì¶œë ¥ íŒŒì‹± ì˜¤ë¥˜?
â†’ 100% ì„±ê³µ âœ…

# 4. ì˜ˆì¸¡ê°’ ë¶„í¬ í™•ì¸
â†’ ì „ë¶€ 0.0! ğŸš©ğŸš©ğŸš©
```

**ê·¼ë³¸ ì›ì¸:**
- ì˜ëª»ëœ ì–´ëŒ‘í„° checkpoint ë°°í¬
- ConfigëŠ” ë§ì§€ë§Œ ì‹¤ì œ weightsê°€ ë‹¤ë¥¸ ëª¨ë¸ìš©
- **ë‚´ê°€ Kaggleì—ì„œ ê²ªì€ ê²ƒê³¼ ë™ì¼í•œ ë¬¸ì œ**

**í•´ê²°ì±…:**
```python
# CI/CD íŒŒì´í”„ë¼ì¸ì— ê²€ì¦ ë‹¨ê³„ ì¶”ê°€
def pre_deployment_validation():
    # 1. Config-Model ì¼ì¹˜ì„± ê²€ì¦
    assert verify_config_matches_model()

    # 2. í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ Sanity check
    test_predictions = model.predict(test_data)
    assert np.std(test_predictions) > 0.05, "Degenerate outputs!"

    # 3. A/B test ì „ì— Shadow deployment
    shadow_test(new_model, production_traffic, sample_rate=0.1)

    # 4. ë¶„í¬ ë¹„êµ
    compare_distribution(new_model, old_model, threshold=0.1)
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ëª¨ë¸ ì„œë¹™ í™˜ê²½

**ìƒí™©:**
A/B í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì—¬ëŸ¬ ë²„ì „ì˜ LoRA ì–´ëŒ‘í„°ë¥¼ ë™ì ìœ¼ë¡œ ë¡œë”©í•˜ëŠ” í™˜ê²½

**ìœ„í—˜:**
```python
# ë²„ì „ë³„ ì–´ëŒ‘í„°
adapters = {
    "v1": "lora_adapter_v1",  # Qwen 1.5Bìš©
    "v2": "lora_adapter_v2",  # Qwen 3Bìš© (ì‹¤ìˆ˜ë¡œ ë“±ë¡!)
}

# ëŸ°íƒ€ì„ì— ë™ì  ë¡œë”©
selected = adapters[traffic_split()]
model = load_adapter(selected)  # v2 ë¡œë”© ì‹œ ë¬¸ì œ ë°œìƒ!
```

**í•´ê²°ì±…:**
```python
class AdapterRegistry:
    def __init__(self):
        self.adapters = {}
        self.validation_cache = {}

    def register(self, name, path, base_model_required):
        # ë“±ë¡ ì‹œ ê²€ì¦
        if not self._validate_compatibility(path, base_model_required):
            raise IncompatibleAdapterError(
                f"{path} is not compatible with {base_model_required}"
            )

        self.adapters[name] = {
            "path": path,
            "base_model": base_model_required,
            "validated_at": datetime.now()
        }

    def _validate_compatibility(self, adapter_path, base_model):
        # ë‚´ê°€ Kaggleì—ì„œ ë°°ìš´ ê²€ì¦ ë¡œì§ ì ìš©
        config = load_config(f"{adapter_path}/adapter_config.json")

        # Config ì¼ì¹˜ì„±
        if config["base_model_name_or_path"] != base_model:
            return False

        # í•™ìŠµ ì•„í‹°íŒ©íŠ¸ ì¡´ì¬
        if not os.path.exists(f"{adapter_path}/train.pkl"):
            return False

        # ì†Œê·œëª¨ í…ŒìŠ¤íŠ¸
        test_pred = quick_test(adapter_path, base_model)
        if np.std(test_pred) < 0.01:  # Degenerate!
            return False

        return True
```

---

## ğŸ”„ ë‹¤ìŒì— ë‹¤ë¥´ê²Œ í•  ê²ƒ

### ë§Œì•½ 2ì‹œê°„ì´ ë” ìˆì—ˆë‹¤ë©´

```python
# ì¦‰ì‹œ ì‹¤í–‰í•  ê²ƒ
model = load_qwen_1_5b_gptq()  # seojinpark ì–´ëŒ‘í„°ì˜ ì •í™•í•œ base model
adapter = load_adapter("seojinpark/fold3")

predictions = predict(test_samples)
# ì˜ˆìƒ: [0.23, 0.87, 0.05, 0.91, 0.34, ...]
#       â†‘ ë‹¤ì–‘í•œ ê°’ ì¶œë ¥!

# ì´ê±¸ë¡œ ê°€ì„¤ Aë¥¼ 100% í™•ì¸ ê°€ëŠ¥
```

**ì˜ˆìƒ ê²°ê³¼:**
- LB ì ìˆ˜: 0.91-0.915 (ë‹¨ì¼ fold)
- Bronze medal ê¶Œ!

---

### ë§Œì•½ 2ì¼ì´ ë” ìˆì—ˆë‹¤ë©´

#### 1. ì–´ëŒ‘í„° í˜¸í™˜ì„± ìë™ ê²€ì¦ ë„êµ¬ ê°œë°œ
```python
def create_adapter_compatibility_matrix():
    """15+ ê³µê°œ ì–´ëŒ‘í„° ì „ìˆ˜ ì¡°ì‚¬"""
    adapters = discover_public_adapters("jigsaw", "qwen")

    results = []
    for adapter in adapters:
        result = {
            "name": adapter.name,
            "config_base_model": adapter.config["base_model"],
            "dataset_name": adapter.dataset_name,
            "has_artifacts": check_artifacts(adapter),
            "test_output": test_on_3_samples(adapter),
            "compatible": validate(adapter)
        }
        results.append(result)

    df = pd.DataFrame(results)
    df.to_csv("adapter_compatibility_matrix.csv")
    return df[df["compatible"] == True]
```

#### 2. Multi-fold Ensemble
```python
# seojinpark fold0~4 ì „ë¶€ ì‚¬ìš©
folds = ["fold0", "fold1", "fold2", "fold3", "fold4"]
predictions = []

for fold in folds:
    adapter = load_adapter(f"seojinpark/{fold}")
    pred = model_with_adapter.predict(test)
    predictions.append(pred)

# Rank averaging (calibration ë¶ˆí•„ìš”)
ensemble_pred = rank_average(predictions)

# ì˜ˆìƒ LB: 0.92-0.925 (Bronze medal!)
```

---

## ğŸ“ ê²°ë¡ 

ì´ ì‹¤íŒ¨ ê²½í—˜ì€ ë‹¨ìˆœí•œ "ëŒ€íšŒ ì‹¤íŒ¨"ê°€ ì•„ë‹ˆë¼, **í”„ë¡œë•ì…˜ ML ì‹œìŠ¤í…œì—ì„œ ë°˜ë“œì‹œ ê²ªê²Œ ë  ë¬¸ì œë¥¼ ë¯¸ë¦¬ ê²½í—˜**í•œ ê²ƒì…ë‹ˆë‹¤.

### í•µì‹¬ êµí›ˆ (Take-aways)

1. **ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ëŠ” ë°˜ë“œì‹œ ê²€ì¦í•˜ë¼**
   - Config, ë°ì´í„°ì…‹ ì´ë¦„, í•™ìŠµ ì•„í‹°íŒ©íŠ¸, ì†Œê·œëª¨ í…ŒìŠ¤íŠ¸

2. **ë‹¨ì¼ ì§€í‘œì— ì†ì§€ ë§ˆë¼**
   - Parsing 100% â‰  ì˜¬ë°”ë¥¸ ë™ì‘
   - ë¶„í¬ ëª¨ë‹ˆí„°ë§ í•„ìˆ˜

3. **Time-boxingìœ¼ë¡œ ë¶„ì„ ë§ˆë¹„ ë°©ì§€**
   - 2ì‹œê°„ rule
   - ëª…í™•í•œ pivot ê¸°ì¤€

4. **í”„ë¡œë•ì…˜ í™˜ê²½ ì—°ê²°**
   - ì´ ë””ë²„ê¹… íŒ¨í„´ì€ CI/CD, ëª¨ë¸ ì„œë¹™ì— ì§ì ‘ ì ìš© ê°€ëŠ¥

---

**ì´ ë¶„ì„ì´ ë„ì›€ì´ ë˜ì…¨ë‹¤ë©´ â­ GitHub Starë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!**

[â† ë©”ì¸ READMEë¡œ ëŒì•„ê°€ê¸°](README_KR.md)

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸:** 2024ë…„ 10ì›” 25ì¼
